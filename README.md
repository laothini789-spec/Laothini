# OmniPOS - ระบบจัดการร้านอาหาร

ระบบ POS สำหรับร้านอาหารและบาร์ที่ครบวงจร พร้อมระบบจัดการโต๊ะ, คลังวัตถุดิบ (BOM), จอครัว (KDS), และระบบวิเคราะห์ด้วย AI

## คุณสมบัติหลัก

- **ระบบจัดการโต๊ะ (Table Management)**: แสดงผังร้านและสถานะโต๊ะแบบเรียลไทม์
- **ระบบ POS (Point of Sale)**: สั่งอาหารและชำระเงินอย่างรวดเร็ว
- **ระบบจัดการออเดอร์**: ติดตามสถานะออเดอร์ตั้งแต่สั่งจนเสริจ
- **ระบบคลังวัตถุดิบ**: ติดตามสต๊อกวัตถุดิบและคำนวณต้นทุน
- **ระบบจัดการพนักงาน**: กำหนดสิทธิ์และจัดการบัญชีพนักงาน
- **ระบบรายงาน**: วิเคราะห์ยอดขายและประสิทธิภาพ
- **ระบบตั้งค่า**: ปรับแต่งร้านค้าและรูปแบบใบเสร็จ

## การติดตั้ง

1. ดาวน์โหลดหรือโคลนโปรเจคนี้
2. ติดตั้ง dependencies:
   ```bash
   npm install
   ```
3. เริ่มต้น development server:
   ```bash
   npm run dev
   ```
4. เปิดเบราว์เซอร์ที่ `http://localhost:3000`

## สคริปต์ที่ใช้งานได้

```bash
npm run dev       # เริ่ม dev server
npm run build     # build สำหรับ production
npm run preview   # preview build ในเครื่อง
```

## ภาพรวมหน้าจอ

เพิ่มภาพหน้าจอหรือ GIF ที่นี่:
- หน้า POS หลัก
- แผนผังโต๊ะ
- หน้าจอ KDS
- รายงาน/แดชบอร์ด

## การใช้งาน

### การเข้าสู่ระบบ
- ใช้ PIN ที่ตั้งไว้ล่วงหน้า:
  - แอดมิน: 1111
  - ผู้จัดการ: 2222
  - พนักงาน: 3333

### การจัดการโต๊ะ
1. เลือก "การจัดการโต๊ะ" จากเมนูด้านซ้าย
2. คลิกที่โต๊ะเพื่อเลือกและสั่งอาหาร
3. ใช้ปุ่ม "สั่งกลับบ้าน" หรือ "สั่งเดลิเวอรี่" สำหรับออเดอร์ที่ไม่ใช่โต๊ะ

### การสั่งอาหาร
1. เลือกหมวดหมู่สินค้า
2. คลิกที่สินค้าเพื่อเพิ่มลงในตะกร้า
3. ปรับแต่งตัวเลือกหากมี (เช่น ระดับความหวาน, ท็อปปิ้ง)
4. เลือกวิธีการชำระเงิน
5. คลิก "ชำระเงิน" เพื่อเสร็จสิ้นออเดอร์

### สั่งอาหารผ่าน QR ตามโต๊ะ
1. สร้าง QR ให้ชี้ไปที่ URL รูปแบบ `http://localhost:3000/?table=t1`
2. เปลี่ยน `t1` เป็นรหัสโต๊ะจริง (ดูใน `constants.ts`)
3. ลูกค้าสแกน QR แล้วสั่งอาหารได้ทันที ระบบจะผูกออเดอร์กับโต๊ะนั้น
4. ในระบบสามารถกด “ตั้งค่า URL QR” และ “พิมพ์ QR ทั้งหมด” ได้ที่หน้าแผนผังโต๊ะ

### การจัดการสินค้าคงคลัง
1. เข้าสู่ระบบด้วยสิทธิ์ผู้จัดการหรือแอดมิน
2. เลือก "สินค้าคงคลัง" จากเมนู
3. จัดการวัตถุดิบและสูตรอาหารได้ที่นี่

## โครงสร้างไฟล์

```
omnipos/
├── components/          # React components
│   ├── POSView.tsx      # หน้า POS หลัก
│   ├── Dashboard.tsx    # แดชบอร์ดรายงาน
│   ├── Sidebar.tsx      # เมนูด้านข้าง
│   └── ...
├── services/            # บริการจัดการข้อมูล
│   └── dataService.ts   # บริการจัดการข้อมูลหลัก
├── types.ts             # นิยามประเภทข้อมูล
├── constants.ts         # ค่าคงที่เริ่มต้น
└── App.tsx              # คอมโพเนนต์หลักของแอป
```

## ประเภทข้อมูลสำคัญ

### OrderStatus
- `PENDING`: รอการยืนยัน
- `CONFIRMED`: ยืนยันแล้ว
- `PREPARING`: กำลังเตรียม
- `READY`: พร้อมเสิร์ฟ
- `COMPLETED`: เสร็จสิ้น
- `CANCELLED`: ยกเลิก

### Role
- `ADMIN`: แอดมิน (สิทธิ์สูงสุด)
- `MANAGER`: ผู้จัดการ
- `STAFF`: พนักงาน

## ความปลอดภัย

- การตรวจสอบรูปแบบ PIN (ต้องเป็นตัวเลข 4 หลัก)
- ล็อกการตรวจสอบ PIN ทั้งที่สำเร็จและล้มเหลว
- ระบบเปลี่ยน PIN สำหรับพนักงาน
- การจัดการสิทธิ์ตามบทบาท

## การพัฒนาเพิ่มเติม

### เพิ่มสินค้าใหม่
สามารถเพิ่มสินค้าใหม่ได้ใน constants.ts หรือผ่านอินเตอร์เฟซของระบบ

### ปรับแต่งประเภทการชำระเงิน
สามารถเพิ่มประเภทการชำระเงินใหม่ได้ใน PaymentMethod enum ใน types.ts

## การตั้งค่าและข้อมูลตัวอย่าง

- ข้อมูลเริ่มต้นอยู่ใน `constants.ts`
- โครงสร้างข้อมูลหลักอยู่ใน `types.ts`
- หากต้องการ seed ข้อมูลเฉพาะร้าน ให้ปรับค่าใน `services/dataService.ts`

## การรองรับอุปกรณ์

- แท็บเล็ต/เดสก์ท็อป (Chrome/Edge รุ่นใหม่)
- จอครัว (KDS) แนะนำจอแยกหรือจอใหญ่
- การพิมพ์ใบเสร็จ: รองรับผ่าน browser print (อุปกรณ์เฉพาะยังไม่รวม)

## การ Deploy

1. สร้าง build:
   ```bash
   npm run build
   ```
2. นำไฟล์ใน `dist/` ไปวางบน static hosting (เช่น Nginx, Netlify, Vercel)

### Deploy ด้วย Netlify + Supabase

1. สร้างโปรเจค Supabase และรันสคริปต์ใน `supabase/schema.sql`
2. ตั้งค่า ENV บน Netlify:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
3. ใน Supabase เปิด Realtime สำหรับตาราง `orders` (Database → Replication)
4. สร้างผู้ใช้พนักงานใน Supabase Auth และเพิ่มโปรไฟล์ลงตาราง `profiles`
5. ดีพลอยด้วย `netlify.toml` (Build: `npm run build`, Publish: `dist`)

หมายเหตุ:
- เมื่อพิมพ์ QR ในหน้าแผนผังโต๊ะ ระบบจะ sync โต๊ะ/โทเคนไปที่ Supabase อัตโนมัติ
- ตัวอย่างนโยบาย RLS ใน `supabase/schema.sql` เปิดให้ลูกค้า insert ออเดอร์ได้แบบสาธารณะเพื่อเดโม หากใช้จริงควรเพิ่มการตรวจสอบโทเคน/Rate limit ฝั่งเซิร์ฟเวอร์
- ตั้งค่า Gemini API Key สำหรับ Edge Function ที่ Supabase (Project Settings → Functions → Secrets): `GEMINI_API_KEY`
- หากต้องการใช้ระบบ PIN แยกบน Supabase ให้เพิ่มข้อมูลใน `staff_pins` ด้วยการ hash PIN ผ่าน `pgcrypto`

### สร้าง PIN บน Supabase (staff_pins)

ตัวอย่างคำสั่ง SQL:
```sql
insert into staff_pins (name, role, permissions, pin_hash)
values (
  'เจ้าของร้าน',
  'ADMIN',
  '["access_pos","access_kitchen","access_reports","access_settings","access_inventory","access_menu"]',
  crypt('1234', gen_salt('bf'))
);
```

## การแก้ไขปัญหา

### ปัญหาทั่วไป
- หากพบปัญหาการโหลดข้อมูล ให้ตรวจสอบ console สำหรับข้อผิดพลาด
- ตรวจสอบว่าใช้ PIN ที่ถูกต้องหรือไม่
- ตรวจสอบว่า browser รองรับฟีเจอร์ที่จำเป็นหรือไม่

## เทคโนโลยีที่ใช้

- React 19+ (ด้วย TypeScript)
- Tailwind CSS สำหรับสไตล์
- Vite สำหรับ build tool
- Lucide React สำหรับ icons
- Recharts สำหรับการแสดงผลกราฟ
- ระบบจัดการสถานะภายในแบบไม่ใช้ external library

## ผู้พัฒนา

ระบบ OmniPOS ถูกพัฒนาโดยทีม FoodStory เพื่อช่วยร้านอาหารในการจัดการธุรกิจอย่างมีประสิทธิภาพ

## การมีส่วนร่วม

ยินดีรับ PR และข้อเสนอแนะ:
- เปิด Issue เพื่อแจ้งบั๊กหรือเสนอฟีเจอร์
- อธิบายขั้นตอนการทดสอบให้ชัดเจนใน PR

## License

ยังไม่ได้ระบุ (โปรดเพิ่มไฟล์ LICENSE หากพร้อมใช้งาน)
